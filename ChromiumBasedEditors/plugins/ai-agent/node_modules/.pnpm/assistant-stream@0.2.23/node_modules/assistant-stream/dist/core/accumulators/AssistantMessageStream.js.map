{"version":3,"sources":["../../../src/core/accumulators/AssistantMessageStream.ts"],"sourcesContent":["import { AssistantStream } from \"../AssistantStream\";\nimport { AssistantMessage } from \"../utils/types\";\nimport { AssistantMessageAccumulator } from \"./assistant-message-accumulator\";\n\nexport class AssistantMessageStream {\n  constructor(public readonly readable: ReadableStream<AssistantMessage>) {\n    this.readable = readable;\n  }\n\n  static fromAssistantStream(stream: AssistantStream) {\n    return new AssistantMessageStream(\n      stream.pipeThrough(new AssistantMessageAccumulator()),\n    );\n  }\n\n  async unstable_result(): Promise<AssistantMessage> {\n    let last: AssistantMessage | undefined;\n    for await (const chunk of this) {\n      last = chunk;\n    }\n\n    if (!last) {\n      return {\n        role: \"assistant\",\n        status: { type: \"complete\", reason: \"unknown\" },\n        parts: [],\n        content: [],\n        metadata: {\n          unstable_state: null,\n          unstable_data: [],\n          unstable_annotations: [],\n          steps: [],\n          custom: {},\n        },\n      };\n    }\n    return last;\n  }\n\n  [Symbol.asyncIterator]() {\n    const reader = this.readable.getReader();\n    return {\n      async next(): Promise<IteratorResult<AssistantMessage, undefined>> {\n        const { done, value } = await reader.read();\n        return done ? { done: true, value: undefined } : { done: false, value };\n      },\n    };\n  }\n\n  tee(): [AssistantMessageStream, AssistantMessageStream] {\n    const [readable1, readable2] = this.readable.tee();\n    return [\n      new AssistantMessageStream(readable1),\n      new AssistantMessageStream(readable2),\n    ];\n  }\n}\n"],"mappings":";AAEA,SAAS,mCAAmC;AAErC,IAAM,yBAAN,MAAM,wBAAuB;AAAA,EAClC,YAA4B,UAA4C;AAA5C;AAC1B,SAAK,WAAW;AAAA,EAClB;AAAA,EAEA,OAAO,oBAAoB,QAAyB;AAClD,WAAO,IAAI;AAAA,MACT,OAAO,YAAY,IAAI,4BAA4B,CAAC;AAAA,IACtD;AAAA,EACF;AAAA,EAEA,MAAM,kBAA6C;AACjD,QAAI;AACJ,qBAAiB,SAAS,MAAM;AAC9B,aAAO;AAAA,IACT;AAEA,QAAI,CAAC,MAAM;AACT,aAAO;AAAA,QACL,MAAM;AAAA,QACN,QAAQ,EAAE,MAAM,YAAY,QAAQ,UAAU;AAAA,QAC9C,OAAO,CAAC;AAAA,QACR,SAAS,CAAC;AAAA,QACV,UAAU;AAAA,UACR,gBAAgB;AAAA,UAChB,eAAe,CAAC;AAAA,UAChB,sBAAsB,CAAC;AAAA,UACvB,OAAO,CAAC;AAAA,UACR,QAAQ,CAAC;AAAA,QACX;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EAEA,CAAC,OAAO,aAAa,IAAI;AACvB,UAAM,SAAS,KAAK,SAAS,UAAU;AACvC,WAAO;AAAA,MACL,MAAM,OAA6D;AACjE,cAAM,EAAE,MAAM,MAAM,IAAI,MAAM,OAAO,KAAK;AAC1C,eAAO,OAAO,EAAE,MAAM,MAAM,OAAO,OAAU,IAAI,EAAE,MAAM,OAAO,MAAM;AAAA,MACxE;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAwD;AACtD,UAAM,CAAC,WAAW,SAAS,IAAI,KAAK,SAAS,IAAI;AACjD,WAAO;AAAA,MACL,IAAI,wBAAuB,SAAS;AAAA,MACpC,IAAI,wBAAuB,SAAS;AAAA,IACtC;AAAA,EACF;AACF;","names":[]}