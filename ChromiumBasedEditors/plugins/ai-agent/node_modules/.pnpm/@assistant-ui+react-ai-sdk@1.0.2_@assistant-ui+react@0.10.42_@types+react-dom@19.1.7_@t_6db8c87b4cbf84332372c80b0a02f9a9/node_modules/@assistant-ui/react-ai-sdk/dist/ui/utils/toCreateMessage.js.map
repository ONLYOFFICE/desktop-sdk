{"version":3,"sources":["../../../src/ui/utils/toCreateMessage.ts"],"sourcesContent":["import { AppendMessage } from \"@assistant-ui/react\";\nimport {\n  CreateUIMessage,\n  FileUIPart,\n  generateId,\n  UIDataTypes,\n  UIMessage,\n  UIMessagePart,\n  UITools,\n} from \"ai\";\n\nexport const toCreateMessage = async <UI_MESSAGE extends UIMessage = UIMessage>(\n  message: AppendMessage,\n): Promise<CreateUIMessage<UI_MESSAGE>> => {\n  const textParts = message.content\n    .filter((part) => part.type === \"text\")\n    .map((t) => t.text)\n    .join(\"\\n\\n\");\n\n  const parts: UIMessagePart<UIDataTypes, UITools>[] = [\n    {\n      type: \"text\",\n      text: textParts,\n    },\n  ];\n\n  // Add image parts\n  const imageParts = message.content\n    .filter((part) => part.type === \"image\")\n    .map(\n      (part) =>\n        ({\n          type: \"file\",\n          mediaType: \"image/png\", // Default to PNG, could be made more dynamic\n          url: part.image,\n        }) satisfies FileUIPart,\n    );\n\n  parts.push(...imageParts);\n\n  // Add attachment parts\n  const attachmentParts = await Promise.all(\n    (message.attachments ?? []).map(async (m) => {\n      if (m.file == null) throw new Error(\"Attachment did not contain a file\");\n      return {\n        type: \"file\",\n        mediaType: m.file.type,\n        filename: m.file.name,\n        url: await getFileDataURL(m.file),\n      } satisfies FileUIPart;\n    }),\n  );\n\n  parts.push(...attachmentParts);\n\n  return {\n    id: generateId(),\n    role: message.role,\n    parts,\n  } satisfies CreateUIMessage<UIMessage> as CreateUIMessage<UI_MESSAGE>;\n};\n\nconst getFileDataURL = (file: File) =>\n  new Promise<string>((resolve, reject) => {\n    const reader = new FileReader();\n\n    reader.onload = () => resolve(reader.result as string);\n    reader.onerror = (error) => reject(error);\n\n    reader.readAsDataURL(file);\n  });\n"],"mappings":";AACA;AAAA,EAGE;AAAA,OAKK;AAEA,IAAM,kBAAkB,OAC7B,YACyC;AACzC,QAAM,YAAY,QAAQ,QACvB,OAAO,CAAC,SAAS,KAAK,SAAS,MAAM,EACrC,IAAI,CAAC,MAAM,EAAE,IAAI,EACjB,KAAK,MAAM;AAEd,QAAM,QAA+C;AAAA,IACnD;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,IACR;AAAA,EACF;AAGA,QAAM,aAAa,QAAQ,QACxB,OAAO,CAAC,SAAS,KAAK,SAAS,OAAO,EACtC;AAAA,IACC,CAAC,UACE;AAAA,MACC,MAAM;AAAA,MACN,WAAW;AAAA;AAAA,MACX,KAAK,KAAK;AAAA,IACZ;AAAA,EACJ;AAEF,QAAM,KAAK,GAAG,UAAU;AAGxB,QAAM,kBAAkB,MAAM,QAAQ;AAAA,KACnC,QAAQ,eAAe,CAAC,GAAG,IAAI,OAAO,MAAM;AAC3C,UAAI,EAAE,QAAQ,KAAM,OAAM,IAAI,MAAM,mCAAmC;AACvE,aAAO;AAAA,QACL,MAAM;AAAA,QACN,WAAW,EAAE,KAAK;AAAA,QAClB,UAAU,EAAE,KAAK;AAAA,QACjB,KAAK,MAAM,eAAe,EAAE,IAAI;AAAA,MAClC;AAAA,IACF,CAAC;AAAA,EACH;AAEA,QAAM,KAAK,GAAG,eAAe;AAE7B,SAAO;AAAA,IACL,IAAI,WAAW;AAAA,IACf,MAAM,QAAQ;AAAA,IACd;AAAA,EACF;AACF;AAEA,IAAM,iBAAiB,CAAC,SACtB,IAAI,QAAgB,CAAC,SAAS,WAAW;AACvC,QAAM,SAAS,IAAI,WAAW;AAE9B,SAAO,SAAS,MAAM,QAAQ,OAAO,MAAgB;AACrD,SAAO,UAAU,CAAC,UAAU,OAAO,KAAK;AAExC,SAAO,cAAc,IAAI;AAC3B,CAAC;","names":[]}